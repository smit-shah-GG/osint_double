---
phase: 08-verification-loop
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - osint_system/agents/sifters/verification/__init__.py
  - osint_system/agents/sifters/verification/schemas.py
  - osint_system/data_management/schemas/verification_schema.py
  - osint_system/data_management/schemas/__init__.py
  - tests/agents/sifters/verification/__init__.py
  - tests/agents/sifters/verification/test_verification_schemas.py
autonomous: true

must_haves:
  truths:
    - "VerificationStatus enum defines all 6 statuses (PENDING, IN_PROGRESS, CONFIRMED, REFUTED, UNVERIFIABLE, SUPERSEDED)"
    - "VerificationResult stores evidence trail with authority-weighted confidence"
    - "EvidenceItem captures source metadata for corroboration evaluation"
    - "VerificationQuery schema supports species-specialized query variants"
  artifacts:
    - path: "osint_system/agents/sifters/verification/schemas.py"
      provides: "Core verification domain schemas"
      exports: ["VerificationStatus", "VerificationResult", "EvidenceItem", "VerificationQuery", "EvidenceEvaluation"]
    - path: "osint_system/data_management/schemas/verification_schema.py"
      provides: "Verification result storage schema"
      exports: ["VerificationResultRecord"]
    - path: "tests/agents/sifters/verification/test_verification_schemas.py"
      provides: "Schema validation tests"
      min_lines: 100
  key_links:
    - from: "osint_system/agents/sifters/verification/schemas.py"
      to: "osint_system/data_management/schemas/classification_schema.py"
      via: "DubiousFlag import"
      pattern: "from.*classification_schema.*import.*DubiousFlag"
    - from: "osint_system/data_management/schemas/__init__.py"
      to: "verification_schema.py"
      via: "public export"
      pattern: "from.*verification_schema.*import"
---

<objective>
Create verification domain schemas for Phase 8 verification loop.

Purpose: Define the data structures for verification status tracking, evidence collection, query generation, and result storage that all Phase 8 components will use.

Output: VerificationStatus enum with 6 statuses, VerificationResult with evidence trail and confidence tracking, EvidenceItem for source evaluation, VerificationQuery for species-specialized queries, and comprehensive tests.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-verification-loop/08-CONTEXT.md
@.planning/phases/08-verification-loop/08-RESEARCH.md
@osint_system/data_management/schemas/classification_schema.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create verification directory structure and core schemas</name>
  <files>
    osint_system/agents/sifters/verification/__init__.py
    osint_system/agents/sifters/verification/schemas.py
  </files>
  <action>
Create the verification submodule directory and core schema file.

**schemas.py must define:**

1. **VerificationStatus(str, Enum)** - Per CONTEXT.md decisions:
   - `PENDING` - Not yet verified
   - `IN_PROGRESS` - Currently being verified
   - `CONFIRMED` - Evidence supports claim
   - `REFUTED` - Evidence contradicts claim
   - `UNVERIFIABLE` - 3 queries exhausted, no evidence found
   - `SUPERSEDED` - Temporal contradiction, was true, no longer current

2. **EvidenceItem(BaseModel)** - Single piece of verification evidence:
   - `source_url: str` - URL of evidence source
   - `source_domain: str` - Domain extracted from URL
   - `source_type: str` - wire_service, news_outlet, official_statement, social_media
   - `authority_score: float` - From SourceCredibilityScorer (0.0-1.0)
   - `snippet: str` - Relevant text excerpt
   - `retrieved_at: datetime` - When evidence was retrieved
   - `supports_claim: bool` - True if supports, False if refutes
   - `relevance_score: float` - How relevant to the claim (0.0-1.0)

3. **VerificationQuery(BaseModel)** - Query for verification search:
   - `query: str` - The search query text
   - `variant_type: Literal["entity_focused", "exact_phrase", "broader_context", "temporal_context", "authority_arbitration", "clarity_enhancement"]`
   - `target_sources: List[str]` - Preferred source types (wire_service, official_statement, etc.)
   - `purpose: str` - Why this query is being used
   - `dubious_flag: DubiousFlag` - Which flag this query addresses

4. **EvidenceEvaluation(BaseModel)** - Result of evidence aggregation:
   - `status: VerificationStatus` - Recommended status
   - `confidence_boost: float` - Cumulative confidence boost from evidence
   - `supporting_evidence: List[EvidenceItem]` - Evidence supporting claim
   - `refuting_evidence: List[EvidenceItem]` - Evidence refuting claim
   - `reasoning: str` - Explanation of evaluation

5. **VerificationResult(BaseModel)** - Complete verification outcome:
   - `fact_id: str`
   - `investigation_id: str`
   - `status: VerificationStatus`
   - `original_confidence: float`
   - `confidence_boost: float` - Per CONTEXT.md: +0.3 wire, +0.2 news, +0.1 social
   - `final_confidence: float` - min(1.0, original + boost)
   - `supporting_evidence: List[EvidenceItem]`
   - `refuting_evidence: List[EvidenceItem]`
   - `query_attempts: int` - How many queries were tried (max 3)
   - `queries_used: List[str]` - The actual queries executed
   - `origin_dubious_flags: List[DubiousFlag]` - Per CONTEXT.md: preserve original flags after verification
   - `related_fact_id: Optional[str]` - For ANOMALY: linked contradiction
   - `contradiction_type: Optional[str]` - negation, numeric, temporal, attribution
   - `reasoning: str`
   - `verified_at: datetime`
   - `requires_human_review: bool` - True for CRITICAL tier
   - `human_review_completed: bool`
   - `human_reviewer_notes: Optional[str]`

**__init__.py** exports all schemas.

Import DubiousFlag from classification_schema, NOT redefine it.
  </action>
  <verify>
`uv run python -c "from osint_system.agents.sifters.verification.schemas import VerificationStatus, VerificationResult, EvidenceItem, VerificationQuery, EvidenceEvaluation; print('All schemas imported')"` succeeds
  </verify>
  <done>
VerificationStatus has 6 values, VerificationResult has all fields including origin_dubious_flags, EvidenceItem supports authority scoring, VerificationQuery supports 6 variant types
  </done>
</task>

<task type="auto">
  <name>Task 2: Create storage schema and integrate with data_management</name>
  <files>
    osint_system/data_management/schemas/verification_schema.py
    osint_system/data_management/schemas/__init__.py
  </files>
  <action>
Create persistence schema for verification results.

**verification_schema.py:**

1. **VerificationResultRecord(BaseModel)** - Extends VerificationResult for storage:
   - All fields from VerificationResult
   - `created_at: datetime` - Record creation timestamp
   - `updated_at: datetime` - Last update timestamp

   Methods:
   - `@classmethod from_result(cls, result: VerificationResult) -> VerificationResultRecord`
   - `to_result(self) -> VerificationResult`

This schema will be used by a future VerificationStore (similar pattern to ClassificationStore).

**Update __init__.py:**
Add exports for verification_schema types alongside existing classification_schema exports.

Follow existing pattern in classification_schema.py for Pydantic model structure, docstrings, and json_schema_extra examples.
  </action>
  <verify>
`uv run python -c "from osint_system.data_management.schemas import VerificationResultRecord, VerificationStatus; print('Storage schemas exported')"` succeeds
  </verify>
  <done>
VerificationResultRecord is exported from data_management.schemas, follows same patterns as FactClassification
  </done>
</task>

<task type="auto">
  <name>Task 3: Add comprehensive schema tests</name>
  <files>
    tests/agents/sifters/verification/__init__.py
    tests/agents/sifters/verification/test_verification_schemas.py
  </files>
  <action>
Create test directory and comprehensive tests for verification schemas.

**test_verification_schemas.py:**

Test categories (use pytest):

1. **VerificationStatus tests:**
   - All 6 values exist and are strings
   - Can be used in conditionals
   - String comparison works

2. **EvidenceItem tests:**
   - Valid construction with all fields
   - authority_score validation (0.0-1.0)
   - relevance_score validation (0.0-1.0)
   - default timestamp is UTC now
   - source_type accepts expected values

3. **VerificationQuery tests:**
   - All 6 variant_types are valid
   - dubious_flag links to DubiousFlag enum
   - target_sources accepts list of strings

4. **EvidenceEvaluation tests:**
   - Status field accepts VerificationStatus
   - Empty evidence lists default correctly
   - confidence_boost can be positive or zero

5. **VerificationResult tests:**
   - All required fields validated
   - final_confidence capped at 1.0
   - origin_dubious_flags preserves original flags
   - requires_human_review defaults to False
   - Related fields for ANOMALY (related_fact_id, contradiction_type)

6. **VerificationResultRecord tests:**
   - from_result() creates valid record
   - to_result() returns equivalent VerificationResult
   - Round-trip preservation

Target: 25+ tests covering all schemas and edge cases.

Use pytest fixtures for reusable test data (sample EvidenceItem, sample VerificationResult).
  </action>
  <verify>
`uv run python -m pytest tests/agents/sifters/verification/test_verification_schemas.py -v` passes with 25+ tests
  </verify>
  <done>
All schema tests pass, coverage includes validation, defaults, relationships, and round-trip serialization
  </done>
</task>

</tasks>

<verification>
1. `uv run python -c "from osint_system.agents.sifters.verification import *"` imports without error
2. `uv run python -c "from osint_system.data_management.schemas import VerificationStatus, VerificationResult, VerificationResultRecord"` succeeds
3. `uv run python -m pytest tests/agents/sifters/verification/ -v` all tests pass
4. `uv run python -c "from osint_system.agents.sifters.verification.schemas import VerificationStatus; print([s.value for s in VerificationStatus])"` shows all 6 statuses
</verification>

<success_criteria>
- VerificationStatus enum has exactly 6 values: PENDING, IN_PROGRESS, CONFIRMED, REFUTED, UNVERIFIABLE, SUPERSEDED
- VerificationResult preserves origin_dubious_flags per CONTEXT.md
- EvidenceItem tracks authority_score and supports_claim for corroboration logic
- VerificationQuery supports all 6 variant types for species-specialized queries
- 25+ tests pass validating all schemas
- Schemas follow existing codebase patterns (Pydantic 2.x, type hints, docstrings)
</success_criteria>

<output>
After completion, create `.planning/phases/08-verification-loop/08-01-SUMMARY.md`
</output>
